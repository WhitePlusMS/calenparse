# 需求文档

## 简介

本功能增强列表视图界面，提供更好的基于时间的组织和日程上下文信息。系统将智能地按完成状态和时间对日程进行排序，同时显示倒计时信息，帮助用户了解日程何时开始或结束。

## 术语表

- **列表视图（List View）**: 应用中所有日历事件的平铺列表显示
- **日程（Event）**: 具有标题、开始时间、结束时间和可选完成状态的日历项目
- **已完成日程（Completed Event）**: 用户已标记为完成的日程
- **进行中日程（Active Event）**: 当前正在进行的日程（当前时间在开始和结束时间之间）
- **未开始日程（Upcoming Event）**: 尚未开始的日程（开始时间在未来）
- **已过期日程（Past Event）**: 结束时间已过的日程
- **倒计时指示器（Countdown Indicator）**: 显示距离日程开始或结束天数的文本显示

## Requirements

### 需求 1

**用户故事：** 作为用户，我希望日程按未完成在前、已完成在后的顺序排列，这样我可以专注于仍需关注的任务。

#### 验收标准

1. WHEN 列表视图显示日程 THEN 列表视图 SHALL 将未完成日程排在已完成日程之前
2. WHILE 显示未完成日程 THEN 列表视图 SHALL 按开始时间升序排序日程
3. WHILE 显示已完成日程 THEN 列表视图 SHALL 按开始时间升序排序日程
4. WHEN 日程的完成状态改变 THEN 列表视图 SHALL 立即重新排序列表

### 需求 2

**用户故事：** 作为用户，我希望看到距离未开始日程还有多少天，这样我可以提前规划和准备。

#### 验收标准

1. WHEN 日程尚未开始 THEN 系统 SHALL 显示距离开始时间的倒计时天数
2. WHEN 日程今天开始 THEN 系统 SHALL 显示"今天开始"
3. WHEN 日程明天开始 THEN 系统 SHALL 显示"明天开始"
4. WHEN 日程在 2 天或更多天后开始 THEN 系统 SHALL 显示"还有 X 天开始"
5. WHEN 显示倒计时 THEN 系统 SHALL 使用视觉上明显的样式以引起注意

### 需求 3

**用户故事：** 作为用户，我希望看到距离进行中日程结束还有多少天，这样我知道还有多少时间来完成它。

#### 验收标准

1. WHEN 日程当前正在进行中 THEN 系统 SHALL 显示距离结束时间的倒计时天数
2. WHEN 日程今天结束 THEN 系统 SHALL 显示"今天结束"
3. WHEN 日程明天结束 THEN 系统 SHALL 显示"明天结束"
4. WHEN 日程在 2 天或更多天后结束 THEN 系统 SHALL 显示"还有 X 天结束"
5. WHEN 显示倒计时 THEN 系统 SHALL 使用与开始倒计时不同的视觉样式

### 需求 4

**用户故事：** 作为用户，我希望已过期的日程不显示倒计时信息，这样界面保持简洁并专注于相关信息。

#### 验收标准

1. WHEN 日程的结束时间已过 THEN 系统 SHALL NOT 显示任何倒计时指示器
2. WHEN 日程被标记为已完成 THEN 系统 SHALL NOT 显示任何倒计时指示器
3. WHEN 日程既已过期又已完成 THEN 系统 SHALL NOT 显示任何倒计时指示器

### 需求 5

**用户故事：** 作为用户，我希望倒计时信息始终保持准确和最新，这样我可以依赖这些信息进行规划。

#### 验收标准

1. WHEN 日历日期改变跨过午夜 THEN 列表视图 SHALL 重新计算所有倒计时值
2. WHEN 日程从未开始状态变为进行中状态 THEN 列表视图 SHALL 立即更新倒计时显示
3. WHEN 日程从进行中状态变为已过期状态 THEN 列表视图 SHALL 立即移除倒计时显示
4. WHILE 列表视图可见 THEN 列表视图 SHALL 每 1 分钟检查并更新倒计时
5. WHILE 列表视图可见且到达午夜时刻 THEN 列表视图 SHALL 强制刷新所有倒计时
6. WHEN 页面获得焦点 THEN 列表视图 SHALL 重新计算所有倒计时值
7. WHILE 列表视图不可见 THEN 列表视图 SHALL 暂停倒计时更新

### 需求 6

**用户故事：** 作为用户，我希望可以自定义倒计时的显示方式，这样符合我的使用习惯。

#### 验收标准

1. WHEN 用户访问设置界面 THEN 设置界面 SHALL 提供倒计时显示开关选项
2. WHEN 用户关闭倒计时显示开关 THEN 列表视图 SHALL 隐藏所有倒计时指示器
3. WHEN 用户在设置中选择倒计时单位 THEN 设置界面 SHALL 提供天、小时、分钟三个选项
4. WHEN 用户保存倒计时设置 THEN 系统 SHALL 将设置持久化到本地存储
5. WHEN 用户重新打开应用 THEN 系统 SHALL 从本地存储加载倒计时设置

## 非功能性需求

### 性能
- 列表排序应在 100ms 内完成
- 倒计时更新不应导致 UI 卡顿
- 支持至少 1000 个日程的流畅显示

### 兼容性
- 支持 Chrome 90+, Firefox 88+, Safari 14+
- 支持暗色模式

### 可维护性
- 倒计时逻辑应独立为可复用的 composable
- 排序逻辑应支持单元测试
