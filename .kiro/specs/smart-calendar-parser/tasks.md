# 实现计划 - MVP 版本

## 任务列表

- [x] 1. 项目初始化和基础配置
  - 创建 Vue 3 + TypeScript + Vite 项目
  - 安装核心依赖：Element Plus, Day.js, Pinia, Supabase, FullCalendar
  - 配置 TypeScript 和 Vite
  - 设置环境变量模板
  - 项目命名为 CalenParse 
  - _需求：所有_

- [x] 2. 设置 Supabase 数据库
  - 创建 Supabase 项目
  - 创建 events 表和索引
  - 配置 Supabase 客户端
  - 测试数据库连接
  - _需求：7.1, 7.2_

- [x] 3. 实现基础类型定义
  - 定义 CalendarEvent 接口
  - 定义 ParsedEvent 接口
  - 定义 LLM API 接口
  - _需求：所有_

- [x] 4. 实现 Supabase 数据操作
  - 创建 useSupabase composable
  - 实现获取所有事件
  - 实现创建事件
  - 实现更新事件
  - 实现删除事件
  - _需求：6.1, 6.2, 6.3, 7.1, 7.2_

- [x] 5. 实现 LLM 解析服务
  - 创建 useLLM composable
  - 实现 LLM API 调用
  - 实现解析结果处理
  - 处理解析错误
  - 实现输入验证（空输入、超长文本）
  - 实现重试机制
  - _需求：1.2, 1.3, 1.4, 2.1-2.13_

- [x] 6. 实现事件管理 composable
  - 创建 useEvents composable
  - 实现事件状态管理（单例模式）
  - 实现 CRUD 操作封装
  - 实现数据加载和刷新
  - 实现自动初始化
  - _需求：6.1, 6.2, 6.3, 7.2_

- [x] 7. 实现输入面板组件
  - 创建 InputPanel.vue
  - 实现文本输入框
  - 实现解析按钮
  - 实现加载状态显示
  - 实现空输入验证
  - 实现超长文本警告
  - 实现快捷键支持（Ctrl+Enter）
  - _需求：1.1, 1.2, 1.3, 1.4_

- [x] 8. 实现预览对话框组件
  - 创建 PreviewDialog.vue
  - 显示解析结果
  - 实现字段编辑功能
  - 实现确认和取消按钮
  - 处理未识别字段标注
  - 实现多事件导航
  - _需求：2.9, 2.11, 2.14, 4.1, 4.2, 4.5, 4.6_

- [x] 9. 实现日历视图组件
  - 创建 CalendarView.vue
  - 集成 FullCalendar 库
  - 实现月视图显示
  - 实现事件渲染（显示标题、时间、地点）
  - 实现事件点击交互
  - 实现空状态显示
  - 实现加载状态
  - _需求：3.1, 3.2, 3.3, 3.4, 3.7_

- [x] 10. 实现事件详情对话框
  - 创建 EventDialog.vue
  - 显示事件完整信息（包括原始通告文本）
  - 实现查看和编辑模式切换
  - 实现保存和取消
  - 实现删除功能（带确认）
  - 实现表单验证
  - _需求：3.3, 6.1, 6.2, 6.3, 6.4_

- [x] 11. 实现主应用布局
  - 创建 App.vue 主布局
  - 集成输入面板
  - 集成日历视图
  - 集成事件对话框
  - 实现响应式布局
  - 实现事件流转（点击、编辑、删除）
  - _需求：所有_

- [x] 12. 实现日期工具函数
  - 创建 date.ts
  - 实现日期格式化
  - 实现日期解析（绝对日期和相对日期）
  - 实现日期验证
  - 实现全天事件支持
  - 实现日期计算工具函数
  - _需求：5.1, 5.2, 5.3, 5.4_

- [x] 13. 实现错误处理
  - 创建 errorHandler.ts
  - 实现错误分类（网络、API、验证、数据库）
  - 实现友好的错误提示
  - 实现重试机制
  - 实现错误通知（Message 和 Notification）
  - _需求：2.13, 10.3_

- [x] 14. 实现通知系统
  - 创建 notifications.ts
  - 实现成功、警告、错误通知
  - 集成到各个操作流程
  - _需求：所有_

- [x] 15. UI/UX 优化
  - 添加加载动画
  - 优化表单验证提示
  - 改进按钮和交互反馈
  - 确保移动端适配
  - 添加动画效果
  - _需求：所有_

- [x] 16. 端到端测试
  - 测试完整的用户流程（输入 → 解析 → 预览 → 创建 → 查看 → 编辑 → 删除）
  - 测试数据持久化（刷新页面后数据保留）
  - 测试错误场景（网络错误、API 错误、验证错误）
  - 测试边界情况（空输入、超长文本、多事件）
  - 测试移动端响应式
  - _需求：所有_

- [x] 17. 性能优化和部署准备
  - 优化 LLM API 调用性能
  - 优化日历渲染性能
  - 检查并修复内存泄漏
  - 准备生产环境配置
  - 编写部署文档
  - _需求：所有_

## 第二阶段：核心扩展功能

- [x] 18. 实现多视图支持





  - 扩展 CalendarView 组件添加视图切换功能
  - 实现日视图（timeGridDay）显示单日详细日程
  - 实现周视图（timeGridWeek）显示一周七天概览
  - 实现年视图（dayGridYear）显示全年日程密度
  - 添加视图状态管理，保存当前视图和选中日期
  - 实现视图间平滑切换和日期定位
  - _需求：3.5, 3.6, 3.7, 3.8, 3.9, 3.10_

- [x] 19. 实现列表视图





  - 创建 ListView.vue 组件
  - 显示所有事件的扁平化列表
  - 按时间顺序排列（从最近到最远）
  - 显示每个事件的日期、时间、标题和地点
  - 实现事件点击查看详情
  - 实现空状态提示
  - 确保与日历视图同步更新
  - _需求：8.1, 8.2, 8.3, 8.4, 8.5, 8.6_

- [x] 20. 实现时间轴视图





  - 创建 TimelineView.vue 组件
  - 使用垂直或水平时间轴布局
  - 按时间顺序排列事件并显示时间间隔
  - 实现平滑滚动显示过去和未来日程
  - 自动调整显示比例避免密集日程重叠
  - _需求：8.7, 8.8, 8.9, 8.10_

- [x] 21. 增强统计仪表板功能




  总事件数、时间段分布（按日/周/月）、地点分布统计
- [x] 22. 实现标签系统




- [x] 22.1 扩展数据模型支持标签


  - 在 Supabase 创建 tags 表
  - 在 events 表添加 tag_ids 字段
  - 更新 TypeScript 类型定义（Tag 接口和 CalendarEvent）
  - _需求：18.1, 18.2, 18.3_

- [x] 22.2 实现标签管理功能


  - 创建 TagManager.vue 组件
  - 在事件编辑对话框添加标签输入
  - 实现标签自动补全
  - 为标签添加颜色选择器
  - 实现标签的创建、编辑、删除、合并
  - _需求：18.1, 18.2, 18.3, 18.6_

- [x] 22.3 实现标签显示和过滤


  - 在日历视图中显示事件标签及颜色
  - 实现标签点击过滤功能
  - 扩展 LLM 提示识别和建议标签
  - _需求：18.4, 18.5, 18.7_

- [x] 23. 实现导入导出功能





- [x] 23.1 实现导出功能

  - 创建 ImportExport.vue 组件或集成到设置
  - 实现 iCal (.ics) 格式导出（使用 ics.js 库）
  - 实现 JSON 格式导出
  - 实现单个或多个事件导出
  - _需求：11.1, 11.2, 11.3_

- [x] 23.2 实现导入功能


  - 实现 iCal 文件解析和导入
  - 实现 JSON 文件验证和导入
  - 实现冲突处理逻辑（保留/覆盖/合并）
  - 处理格式错误和无效数据
  - _需求：11.4, 11.5, 11.6, 11.7_

- [x] 23.3 实现备份和恢复


  - 实现备份下载功能
  - 实现备份文件上传和验证
  - 实现数据恢复并警告覆盖风险
  - 处理备份文件损坏情况
  - _需求：11.8, 11.9, 11.10, 11.11, 11.12_

## 第三阶段：高级功能

- [x] 24. 实现统计分析功能





  - 创建 StatisticsView.vue 组件
  - 使用 Chart.js 或 ECharts 进行数据可视化
  - 实现时间段分布统计（按日/周/月）
  - 实现地点分布统计（饼图或柱状图）
  - 实现事件类型分布统计
  - 添加自定义时间范围选择器
  - 处理缺少地点信息的事件（归类为"未指定地点"）
  - _需求：9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [x] 25. 实现批量操作功能





- [x] 25.1 实现批量选择


  - 在列表视图添加批量操作模式切换
  - 在列表视图添加复选框
  - 在列表视图实现全选/取消全选功能
  - 显示已选择的事件数量
  - 确保选择状态在所有视图中一致
  - _需求：12.1, 12.2_

- [x] 25.2 实现批量操作


  - 创建批量操作工具栏（BatchOperationBar.vue）
  - 实现批量删除（带确认）
  - 创建批量编辑对话框（BatchEditDialog.vue）
  - 实现批量修改共同字段（地点、类型等）
  - 确保批量操作的原子性（全部成功或全部失败）
  - 同步更新所有视图
  - _需求：12.3, 12.4, 12.5, 12.6, 12.7_

## 第四阶段：用户体验优化

- [x] 27. 实现主题定制功能







  - 创建 ThemeSettings.vue 组件
  - 实现深色/浅色模式切换
  - 使用 CSS 变量定义主题颜色
  - 为不同事件类型提供颜色选择器
  - 将主题设置保存到 localStorage
  - 在应用启动时加载并应用主题设置
  - _需求：14.1, 14.2, 14.3, 14.4, 14.5, 14.6_

- [x] 28. 实现分享功能





  - 创建 ShareDialog.vue 组件
  - 实现文本格式分享（复制到剪贴板）
  - 实现图片格式分享（使用 html2canvas）
  - 支持单个事件和多个事件分享
  - 格式化分享内容（标题、时间、地点、描述）
  - 处理重复日程的分享说明
  - _需求：19.1, 19.2, 19.3, 19.4, 19.5, 19.6_

## 第五阶段：可选功能

- [ ] 29. 实现语音输入功能（低优先级）
  - 创建 useVoiceInput composable
  - 使用 Web Speech API (SpeechRecognition)
  - 在 InputPanel 添加语音输入按钮
  - 请求麦克风权限
  - 显示录音状态指示器
  - 实时或录音结束后转换为文字并填充到输入框
  - 处理浏览器兼容性（检测 API 支持，不支持时隐藏按钮）
  - 处理识别错误和重试
  - _需求：22.1, 22.2, 22.3, 22.4, 22.5, 22.6_
  - _设计：属性 38_

- [x] 30. 实现任务完成状态功能




  - 更新数据库 schema 添加 is_completed 字段
  - 更新 TypeScript 类型定义添加 isCompleted 属性
  - 在 EventDialog 中添加完成状态复选框
  - 在 CalendarView 中为已完成事件添加视觉样式（半透明、删除线）
  - 在 ListView 中添加可点击的完成状态复选框
  - 实现快速切换完成状态的功能
  - 在 useEvents composable 中添加 toggleEventCompletion 方法
  - 添加按完成状态筛选的选项（可选）
  - 确保完成状态在所有视图中同步更新
  - _需求：23.1, 23.2, 23.3, 23.4, 23.5, 23.6, 23.7, 23.8_
  - _设计：属性 39, 40_

## 开发注意事项

### 环境变量配置

创建 `.env` 文件：
```
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_LLM_API_KEY=your-llm-api-key
VITE_LLM_API_ENDPOINT=your-llm-endpoint
VITE_LLM_MODEL=gpt-3.5-turbo
```

### 已安装依赖

所有核心依赖已安装：
- Vue 3.5.24
- TypeScript 5.9.3
- Element Plus 2.11.8
- Day.js 1.11.19
- Pinia 3.0.4
- Supabase JS 2.84.0
- FullCalendar 6.1.19

### 架构说明

- **数据层**: Supabase (PostgreSQL) 用于持久化存储
- **状态管理**: useEvents composable 使用单例模式管理全局状态
- **LLM 集成**: useLLM composable 处理文本解析
- **UI 组件**: 使用 Element Plus + Scoped CSS
- **日历**: FullCalendar 提供月视图

### MVP 已完成功能 ✅

✅ 完整的 CRUD 操作（创建、读取、更新、删除事件）
✅ LLM 文本解析（支持多事件、相对日期、字段识别）
✅ 预览和编辑解析结果
✅ 月视图日历展示
✅ 事件详情查看和编辑
✅ 错误处理和用户通知
✅ 响应式设计（支持移动端）
✅ 数据持久化到 Supabase
✅ 性能优化（代码分割、LLM 缓存、浅层响应式）
✅ 部署文档和配置

### 待实现功能（按优先级）

#### 第二阶段：核心扩展功能
- 多视图支持（日/周/年视图）
- 列表视图和时间轴视图
- 热力图视图
- 标签系统
- 导入导出（iCal/JSON）和备份恢复

#### 第三阶段：高级功能
- 统计分析和可视化
- 批量操作
- 智能更新已有日程

#### 第四阶段：用户体验优化
- 主题定制（深色/浅色模式）
- 分享功能

#### 第五阶段：可选功能
- 语音输入（低优先级）

### 当前实现状态总结

#### ✅ 已完成功能（Tasks 1-28）

**MVP 核心功能：**
- 完整的项目架构和配置
- LLM 文本解析和预览编辑
- 日历视图（月视图 + 多视图支持：日/周/年）
- 列表视图和统计分析视图
- 事件 CRUD 操作
- Supabase 数据持久化
- 错误处理和通知系统
- 响应式设计

**扩展功能：**
- 标签系统（创建、编辑、删除、过滤）
- 导入导出（iCal/JSON 格式）
- 备份和恢复
- 批量操作（批量选择、删除、编辑）
- 统计分析和可视化
- 主题定制（深色/浅色模式、自定义颜色）
- 分享功能（文本和图片格式）

#### 🚧 待实现功能（Tasks 26, 29, 30）

**高优先级：**
- Task 26: 智能更新功能 - 通过新文本智能更新已有日程
- Task 30: 任务完成状态 - 标记事件为已完成/未完成

**低优先级：**
- Task 29: 语音输入功能 - 使用语音转文字输入通告

### 开发建议

- 每个阶段完成后进行测试验证
- 优先实现用户需求最高的功能
- 保持代码质量和可维护性
- 定期更新文档
