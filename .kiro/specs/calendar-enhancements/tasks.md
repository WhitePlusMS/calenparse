# 实施计划

- [x] 1. 数据库架构更新






  - 更新 Supabase 数据库架构以支持重复事件和模板
  - 添加 `recurrence_rule`、`recurrence_id`、`is_recurring`、`is_template`、`template_name` 字段到 events 表
  - 创建必要的索引以优化查询性能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 9.1, 9.2, 9.3, 11.1_

- [x] 2. 类型定义扩展



  - 扩展 `src/types/index.ts` 以包含重复事件和模板相关类型
  - 添加 `RecurrenceFrequency`、`RecurrenceEndType`、`RecurrenceRule` 类型
  - 更新 `CalendarEvent` 接口以包含重复和模板字段
  - 更新 `ParsedEvent` 接口以包含 `recurrencePattern` 字段
  - 添加 `SearchFilters` 接口
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 4.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1_

- [x] 3. 重复事件核心逻辑实现



  - [x] 3.1 创建 `src/composables/useRecurrence.ts`


    - 实现 `generateRecurrenceInstances` 函数生成重复事件实例
    - 实现 `validateRecurrenceRule` 函数验证重复规则
    - 实现 `formatRecurrenceDescription` 函数格式化重复规则描述
    - 实现 `getNextRecurrenceDate` 函数计算下一个重复日期
    - _需求: 1.2, 1.3, 1.4, 1.5, 2.2_
  - [ ]* 3.2 为 useRecurrence 编写属性测试
    - **属性 1: 每日重复间隔一致性**
    - **验证: 需求 1.2**
  - [ ]* 3.3 为 useRecurrence 编写属性测试
    - **属性 2: 每周重复星期几一致性**
    - **验证: 需求 1.3**
  - [ ]* 3.4 为 useRecurrence 编写属性测试
    - **属性 3: 每月重复日期一致性**
    - **验证: 需求 1.4**
  - [ ]* 3.5 为 useRecurrence 编写属性测试
    - **属性 4: 重复结束条件遵守**
    - **验证: 需求 1.5**
  - [ ]* 3.6 为 useRecurrence 编写属性测试
    - **属性 5: 自定义每周重复星期几匹配**
    - **验证: 需求 2.2**
  - [ ]* 3.7 为 useRecurrence 编写属性测试
    - **属性 6: 重复规则持久化往返**
    - **验证: 需求 2.3**
  - [ ]* 3.8 为 useRecurrence 编写属性测试
    - **属性 7: 重复规则描述完整性**
    - **验证: 需求 2.4**

- [x] 4. 重复规则编辑器组件



  - [x] 4.1 创建 `src/components/RecurrenceEditor.vue`


    - 实现频率选择（每日、每周、每月、自定义）
    - 实现间隔输入
    - 实现星期几选择（用于每周和自定义重复）
    - 实现结束条件选择（永不、日期、次数）
    - 实时显示重复规则描述
    - _需求: 1.1, 2.1, 2.2_
  - [ ]* 4.2 为 RecurrenceEditor 编写单元测试
    - 测试频率选择交互
    - 测试间隔输入验证
    - 测试星期几选择
    - 测试结束条件配置
    - _需求: 1.1, 2.1, 2.2_

- [x] 5. 集成重复事件到 EventDialog




  - 更新 `src/components/EventDialog.vue` 以包含 RecurrenceEditor
  - 在编辑模式下显示重复规则编辑器
  - 在查看模式下显示重复规则描述
  - 处理重复规则的保存和验证
  - _需求: 1.1, 2.1, 2.3, 2.4_
- [x] 6. 更新 useEvents 以支持重复事件




- [ ] 6. 更新 useEvents 以支持重复事件

  - 修改 `createEvent` 以处理重复规则并生成实例
  - 修改 `updateEvent` 以处理重复事件的更新
  - 修改 `deleteEvent` 以处理重复事件组的删除
  - 添加批量操作支持重复事件
  - _需求: 1.2, 1.3, 1.4, 1.5, 2.2, 2.3_

- [x] 7. Checkpoint - 确保所有测试通过




  - 确保所有测试通过，如有问题请询问用户
- [-] 8. 搜索和过滤核心逻辑实现

- [ ] 8. 搜索和过滤核心逻辑实现

  - [x] 8.1 创建 `src/composables/useSearch.ts`



    - 实现 `applyFilters` 函数应用搜索过滤
    - 实现 `getUniqueLocations` 函数获取所有唯一地点
    - 实现关键词搜索逻辑（标题、描述、地点）
    - 实现日期范围筛选逻辑
    - 实现地点筛选逻辑
    - 实现标签筛选逻辑
    - _需求: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4, 7.1, 7.2, 7.3, 7.4_
  - [ ]* 8.2 为 useSearch 编写属性测试
    - **属性 8: 关键词搜索匹配正确性**
    - **验证: 需求 4.1**
  - [ ]* 8.3 为 useSearch 编写属性测试
    - **属性 9: 日期范围筛选边界正确性**
    - **验证: 需求 5.1**
  - [ ]* 8.4 为 useSearch 编写属性测试
    - **属性 10: 唯一地点列表完整性**
    - **验证: 需求 6.1**
  - [ ]* 8.5 为 useSearch 编写属性测试
    - **属性 11: 地点筛选匹配正确性**
    - **验证: 需求 6.2**
  - [ ]* 8.6 为 useSearch 编写属性测试
    - **属性 12: 地点搜索筛选正确性**
    - **验证: 需求 6.3**
  - [ ]* 8.7 为 useSearch 编写属性测试
    - **属性 13: 唯一标签列表完整性**
    - **验证: 需求 7.1**
  - [ ]* 8.8 为 useSearch 编写属性测试
    - **属性 14: 标签筛选匹配正确性**
    - **验证: 需求 7.2**

- [-] 9. 搜索栏组件实现


  - [x] 9.1 创建 `src/components/SearchBar.vue`



    - 实现关键词搜索输入框
    - 实现日期范围选择器（包含预设选项：今天、本周、本月）
    - 实现地点筛选下拉框（多选）
    - 实现标签筛选下拉框（多选）
    - 显示当前激活的筛选条件
    - 提供清除单个或全部筛选的功能
    - 实时显示筛选结果数量
    - _需求: 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4, 7.1, 7.2, 7.3, 7.4_
  - [ ]* 9.2 为 SearchBar 编写单元测试
    - 测试关键词搜索输入
    - 测试日期范围选择
    - 测试预设日期范围应用
    - 测试地点筛选
    - 测试标签筛选
    - 测试清除筛选功能
    - _需求: 4.1, 5.1, 6.1, 7.1_

- [x] 10. 集成搜索栏到主应用





  - 在 `src/App.vue` 或适当位置添加 SearchBar 组件
  - 连接 SearchBar 与 CalendarView 和 ListView
  - 确保筛选结果实时更新所有视图
  - _需求: 4.1, 4.4, 5.4, 6.4, 7.3_

- [ ] 11. Checkpoint - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [-] 12. LLM 解析增强 - 重复模式识别


  - [x] 12.1 创建 `src/utils/recurrence-parser.ts`



    - 实现 `parseRecurrencePattern` 函数解析重复模式字符串
    - 支持识别"每天"、"每周X"、"每月X日"等模式
    - 支持识别自定义模式如"每周二和周四"
    - 支持识别结束条件如"持续4周"、"到12月31日"
    - _需求: 8.1, 8.3, 8.4_
  - [ ]* 12.2 为 recurrence-parser 编写属性测试
    - **属性 15: 重复模式解析识别**
    - **验证: 需求 8.1**
  - [ ]* 12.3 为 recurrence-parser 编写属性测试
    - **属性 16: 重复结束条件解析**
    - **验证: 需求 8.3**
  - [ ]* 12.4 为 recurrence-parser 编写属性测试
    - **属性 17: 自定义重复模式解析**
    - **验证: 需求 8.4**

- [x] 13. 更新 useLLM 以支持重复模式




  - 更新 `src/composables/useLLM.ts` 的 prompt 以识别重复模式
  - 更新 `processEvents` 函数以处理 `recurrencePattern` 字段
  - 集成 `parseRecurrencePattern` 将 LLM 识别的模式转换为 `RecurrenceRule`
  - 在预览中显示识别的重复规则
  - _需求: 8.1, 8.2, 8.3, 8.4_
-

- [x] 14. 事件模板核心逻辑实现



  - [x] 14.1 创建 `src/composables/useTemplates.ts`


    - 实现 `createTemplateFromEvent` 函数从事件创建模板
    - 实现 `createEventFromTemplate` 函数从模板创建事件
    - 实现 `updateTemplate` 函数更新模板
    - 实现 `deleteTemplate` 函数删除模板
    - 实现 `convertEventToTemplate` 函数将事件转换为模板
    - 实现 `convertTemplateToEvent` 函数将模板转换为事件
    - 使用计算属性过滤模板列表
    - _需求: 9.1, 9.2, 9.3, 9.4, 10.1, 10.2, 10.3, 10.4, 11.1, 11.2, 11.3, 11.4_
  - [ ]* 14.2 为 useTemplates 编写属性测试
    - **属性 18: 模板创建不包含日期时间**
    - **验证: 需求 9.2**
  - [ ]* 14.3 为 useTemplates 编写属性测试
    - **属性 19: 模板持久化往返**
    - **验证: 需求 9.3**
  - [ ]* 14.4 为 useTemplates 编写属性测试
    - **属性 20: 从模板创建事件字段完整性**
    - **验证: 需求 10.1**
  - [ ]* 14.5 为 useTemplates 编写属性测试
    - **属性 21: 从模板创建事件持久化往返**
    - **验证: 需求 10.3**
  - [ ]* 14.6 为 useTemplates 编写属性测试
    - **属性 22: 模板独立性（事件修改）**
    - **验证: 需求 10.4**
  - [ ]* 14.7 为 useTemplates 编写属性测试
    - **属性 23: 模板更新持久化往返**
    - **验证: 需求 11.2**
  - [ ]* 14.8 为 useTemplates 编写属性测试
    - **属性 24: 模板删除完整性**
    - **验证: 需求 11.3**
  - [ ]* 14.9 为 useTemplates 编写属性测试
    - **属性 25: 模板独立性（模板删除）**
    - **验证: 需求 11.4**
-

- [x] 15. 模板管理组件实现



  - [x] 15.1 创建 `src/components/TemplateManager.vue`


    - 实现模板列表视图
    - 实现模板预览功能
    - 实现模板编辑功能
    - 实现模板删除功能（带确认）
    - 实现从模板创建事件的快速入口
    - _需求: 9.4, 10.1, 10.2, 11.1, 11.2, 11.3_
  - [ ]* 15.2 为 TemplateManager 编写单元测试
    - 测试模板列表显示
    - 测试模板预览
    - 测试模板编辑
    - 测试模板删除确认
    - 测试从模板创建事件
    - _需求: 9.4, 10.1, 11.1, 11.2, 11.3_
- [x] 16. 集成模板功能到 EventDialog




- [ ] 16. 集成模板功能到 EventDialog

  - 在 `src/components/EventDialog.vue` 添加"保存为模板"按钮
  - 实现保存为模板的对话框（输入模板名称）
  - 在查看模式下显示模板相关信息
  - _需求: 9.1, 9.2_

- [x] 17. 快速操作 - 双击创建事件





  - 更新 `src/components/CalendarView.vue` 添加双击事件处理
  - 实现 `handleDateDblClick` 处理日期单元格双击（月视图）
  - 实现 `handleTimeSlotDblClick` 处理时间槽双击（日/周视图）
  - 打开 EventDialog 并预填充日期/时间
  - 自动聚焦标题输入框
  - 支持 Enter 键快速保存
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 18. 创建测试数据生成器


  - [ ] 18.1 创建 `src/test/generators.ts`
    - 实现 `arbRecurrenceRule` 生成有效的重复规则
    - 实现 `arbCalendarEvent` 生成有效的日历事件
    - 实现 `arbTemplate` 生成有效的事件模板
    - 实现 `arbSearchFilters` 生成有效的搜索过滤器
    - _用于属性测试_
  - [ ]* 18.2 为生成器编写验证测试
    - 验证生成的数据符合类型约束
    - 验证生成的数据覆盖边缘情况
    - _用于属性测试_

- [ ] 19. Final Checkpoint - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
  - 验证所有功能集成正常工作
  - 检查性能和用户体验
