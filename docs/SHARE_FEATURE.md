# 分享功能实现文档

## 概述

实现了完整的日程分享功能，允许用户以文本或图片格式分享单个或多个日程事件。

## 实现的功能

### 1. 文本格式分享 ✅
- **需求 19.1, 19.2**: 生成包含所有事件信息的文本内容
  - ✅ 标题
  - ✅ 时间（开始和结束）
  - ✅ 地点
  - ✅ 标签
  - ✅ 描述
  - ✅ 原始通告文本
  - ✅ 创建时间
  - ✅ 更新时间
- **需求 19.3**: 支持复制到剪贴板
- **需求 19.4**: 支持单个和多个事件分享
- 格式化输出，包含表情符号增强可读性
- 自动处理全天事件和时间范围事件

### 2. 图片格式分享 ✅
- **需求 19.6**: 使用 html2canvas 生成可视化图片
- 精美的渐变背景设计
- 完整的事件信息展示：
  - ✅ 标题和时间
  - ✅ 地点
  - ✅ 标签（带颜色）
  - ✅ 描述
  - ✅ 原始通告文本
  - ✅ 创建和更新时间戳
- 支持下载为 PNG 格式
- 高分辨率输出（2x scale）
- 响应式设计，自动调整布局

### 3. 用户界面 ✅
- **ShareDialog 组件**: 独立的分享对话框
- 格式切换：文本/图片
- 实时预览
- 响应式设计，支持移动端

### 4. 集成点 ✅
- **EventDialog**: 在事件详情对话框中添加"分享"按钮，支持分享单个事件
- **App.vue**: 在主界面添加"分享"按钮，支持分享所有事件

## 文件结构

```
src/
├── components/
│   ├── ShareDialog.vue          # 分享对话框组件
│   ├── EventDialog.vue          # 更新：添加分享按钮
│   └── App.vue                  # 更新：添加批量分享按钮
└── utils/
    └── share.ts                 # 分享工具函数
```

## 核心函数

### `formatEventAsText(event: CalendarEvent, tags?: Tag[]): string`
格式化单个事件为文本，包含所有信息字段（标题、时间、地点、标签、描述、原始文本、时间戳）。

### `generateShareText(events: CalendarEvent[], tags?: Tag[]): string`
生成格式化的分享文本，支持单个和多个事件，包含完整的事件信息。

### `copyToClipboard(text: string): Promise<void>`
将文本复制到剪贴板，支持现代和传统浏览器。

### `generateShareImage(element: HTMLElement): Promise<Blob>`
使用 html2canvas 将 HTML 元素转换为图片。

### `downloadBlob(blob: Blob, filename: string): void`
下载 Blob 对象为文件。

## 使用方式

### 分享单个事件
1. 点击日历中的事件打开详情对话框
2. 点击"分享"按钮
3. 选择文本或图片格式
4. 点击"复制到剪贴板"或"下载图片"

### 分享所有事件
1. 在主界面点击"分享"按钮
2. 选择文本或图片格式
3. 预览所有事件
4. 点击"复制到剪贴板"或"下载图片"

## 技术实现

### 依赖
- `html2canvas`: ^1.4.1 - 用于生成图片

### 特性
- **错误处理**: 完善的错误提示和异常处理
- **浏览器兼容**: 支持现代和传统浏览器的剪贴板 API
- **响应式设计**: 适配桌面和移动设备
- **性能优化**: 高质量图片生成，加载提示

## 测试验证

### 构建测试
```bash
npm run build
```
✅ 构建成功，无 TypeScript 错误

### 功能测试
- ✅ 文本格式生成正确
- ✅ 图片格式渲染美观
- ✅ 复制到剪贴板功能正常
- ✅ 图片下载功能正常
- ✅ 单个事件分享
- ✅ 多个事件分享
- ✅ 空事件列表处理

## 未来改进

1. **社交媒体集成**: 直接分享到微信、微博等平台
2. **自定义模板**: 允许用户自定义分享图片样式
3. **二维码生成**: 生成包含事件信息的二维码
4. **批量选择**: 允许用户选择特定事件进行分享

## 需求覆盖

- ✅ 需求 19.1: 生成包含事件详情的文本内容
- ✅ 需求 19.2: 包含标题、时间、地点和描述
- ✅ 需求 19.3: 复制内容到剪贴板
- ✅ 需求 19.4: 支持单个和多个事件分享
- ✅ 需求 19.5: 格式化分享内容（通过表情符号和结构化布局）
- ✅ 需求 19.6: 导出为图片格式

## 截图说明

### 文本格式预览
- 清晰的文本格式
- 表情符号增强可读性
- 分隔线区分多个事件

### 图片格式预览
- 渐变紫色背景
- 半透明卡片设计
- 清晰的事件信息层次
- 完整信息展示：
  - 标题和时间
  - 地点信息
  - 彩色标签
  - 描述内容
  - 原始通告文本
  - 创建和更新时间
- 品牌标识和生成时间戳

## 总结

分享功能已完整实现，满足所有需求规格。用户可以方便地以文本或图片格式分享日程事件，提升了应用的社交性和实用性。
